<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIew Allocated Jobs</title>
    <link rel="stylesheet" href="Style.css">
    <link rel="stylesheet" href="Allocate_jobs.css">
    <script src="clock.js"></script>
    <link rel="icon" href="./logo.JPG" type="image/x-icon">
</head>

<style>


</style>
<body>
    <header>
        <img src="logo-minew.png" alt="" class="imglogo">
        <h1>Allocated Jobs</h1>
    </header>
    <div class="navbar1">
        <a href="layout.html">‚Üê Back to Home</a>
    </div>

    <div class="container1">
        <div class="view-allocated-jobs">
            <h2>View Allocated Jobs</h2>
            <div class="staff-cards-container" id="staff-cards-container">
                <!-- Staff cards will be displayed here -->
            </div>
            <div id="allocated-jobs-list" class="job-cards-container">
                <!-- Allocated jobs will be displayed here -->
            </div>
        </div>
    </div>
</div>

<div id="jobModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Allocated Jobs</h2>
      <table id="jobsTable">
        <thead>
          <tr>
            <th>Job ID</th>
            <th>Customer</th>
            <th>Allocation Date</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
</main>

 <script>
    fetch(`${backendBaseUrl}/get-staff`)
    .then(response => response.json())
    .then(data => {
        if (Array.isArray(data.staff)) {
            const staffCardsContainer = document.getElementById('staff-cards-container');
            staffCardsContainer.innerHTML = '';

            data.staff.forEach(staff => {
                const staffCard = document.createElement('div');
                staffCard.className = 'staff-card';
                staffCard.innerHTML = `
                    <h3>${staff}</h3>
                    <p>Click to view allocated jobs</p>
                `;

                staffCard.addEventListener('click', () => {
                    fetch(`${backendBaseUrl}/get-allocated-jobs?staffName=${encodeURIComponent(staff)}`)
                        .then(response => response.json())
                        .then(data => {
                            const modal = document.getElementById('jobModal');
                            const tbody = document.querySelector('#jobsTable tbody');
                            tbody.innerHTML = '';

                            if (Array.isArray(data.jobs) && data.jobs.length > 0) {
                                data.jobs.forEach(job => {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td>${job.jobId}</td>
                                        <td>${job.customerName}</td>
                                        <td>${job.allocationDate?.split(' ')[0] || 'N/A'}</td>
                                    `;
                                    tbody.appendChild(row);
                                });
                            } else {
                                const row = document.createElement('tr');
                                row.innerHTML = `<td colspan="3">No jobs allocated to this staff member.</td>`;
                                tbody.appendChild(row);
                            }

                            modal.style.display = 'block';
                        })
                        .catch(error => {
                            console.error('Error fetching allocated jobs:', error);
                            alert('Failed to load allocated jobs.');
                        });
                });

                staffCardsContainer.appendChild(staffCard);
            });
        } else {
            console.error('Unexpected response format:', data);
            alert('Error: Unexpected response format from the server.');
        }
    })
    .catch(error => console.error('Error fetching staff:', error));

    //close Modal
    document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('jobModal');
    const closeBtn = document.querySelector('.modal .close');

    closeBtn.onclick = () => {
      modal.style.display = 'none';
    };

    window.onclick = (event) => {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    };
  });
 </script>   
</body>
</html>